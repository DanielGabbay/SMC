<div class="container mx-auto p-4 sm:p-6 lg:p-8">
  <div class="flex justify-between items-center mb-6">
    <div class="flex items-center gap-4">
      <h1 class="text-3xl font-bold text-base-content">ניהול הזמנות</h1>
      <a routerLink="/developers" title="Developer Tools" class="btn btn-ghost btn-circle">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" /></svg>
      </a>
    </div>
    <button (click)="newBookingDialog.showModal()" class="btn btn-primary">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
      </svg>
      הזמנה חדשה
    </button>
  </div>

  <div class="bg-base-100 shadow-lg rounded-lg overflow-hidden">
    <div class="overflow-x-auto">
      @if (bookings().length > 0) {
        <table class="table w-full">
          <thead>
            <tr>
              <th>לקוח</th>
              <th>תאריכים</th>
              <th>סכום</th>
              <th class="text-center">סטטוס</th>
              <th>פעולות</th>
            </tr>
          </thead>
          <tbody>
            @for (booking of bookings(); track booking.id) {
              <tr class="hover">
                <td>
                  <div class="font-bold">{{ booking.customer.fullName }}</div>
                  <div class="text-sm opacity-50">{{ booking.customer.phone }}</div>
                </td>
                <td>
                  {{ booking.checkIn }} עד {{ booking.checkOut }}
                </td>
                <td>₪{{ booking.totalAmount.toLocaleString() }}</td>
                <td class="text-center">
                  @switch (booking.status) {
                    @case ('confirmed') {
                      <div class="badge badge-success gap-2">מאושרת</div>
                    }
                    @case ('pending') {
                      <div class="badge badge-warning gap-2">ממתינה</div>
                    }
                    @case ('canceled') {
                      <div class="badge badge-error gap-2">בוטלה</div>
                    }
                  }
                </td>
                <td>
                  <div class="flex items-center space-x-2 space-x-reverse">
                      @if (booking.status === 'pending') {
                        <button (click)="copyLink(booking.id)" title="העתק קישור" class="btn btn-ghost btn-sm btn-square">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" /><path d="M4 3a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V3z" /></svg>
                        </button>
                        <a [href]="getWhatsAppLink(booking.id)" target="_blank" title="שלח בווטסאפ" class="btn btn-ghost btn-sm btn-square">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.04C6.5 2.04 2.04 6.5 2.04 12c0 1.8.46 3.48 1.28 4.95L2 22l5.25-1.38c1.4.78 3.03 1.22 4.75 1.22 5.5 0 9.96-4.46 9.96-9.96S17.5 2.04 12 2.04zm4.83 11.5c-.25.42-1.43 1.34-1.73 1.45s-.53.18-.98-.1-1.88-1.2-3.5-2.9-1.3-2.28-.98-2.65.45-.5.65-.65.25-.42.42-.78-.05-.88-.2-1.08c-.15-.2-.3-.23-.48-.23-.2 0-.43.03-.63.23s-.68.65-1.08 1.38c-.35.7-.58 1.48-.58 2.25s.68 2.5 1.23 3.05c.55.55 1.95 2.23 4.68 3.25 2.73 1.02 3.43.8 4.03.75.6-.05 1.73-.7 1.98-1.38s.25-1.28.18-1.45c-.08-.18-.28-.28-.53-.5z"/></svg>
                        </a>
                        <a [href]="getSmsLink(booking.id)" target="_blank" title="שלח ב-SMS" class="btn btn-ghost btn-sm btn-square">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd" /></svg>
                        </a>
                      }
                      <button (click)="openDeleteModal(booking)" title="מחק הזמנה" class="btn btn-ghost btn-sm btn-square text-error">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                      </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      } @else {
        <div class="text-center p-12">
          <p class="text-lg text-base-content/70">לא נמצאו הזמנות.</p>
          <p class="mt-2 text-base-content/50">לחץ על "הזמנה חדשה" כדי להתחיל.</p>
        </div>
      }
    </div>
  </div>
</div>

<!-- New Booking Modal -->
<dialog id="newBookingDialog" #newBookingDialog class="modal">
  <div class="modal-box w-11/12 max-w-4xl p-0 flex flex-col max-h-[calc(100vh-4rem)]">
    <app-new-booking (close)="newBookingDialog.close()"></app-new-booking>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<!-- Delete Confirmation Modal -->
<dialog id="deleteBookingDialog" class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg">מחיקת הזמנה</h3>
    @if (bookingToDelete(); as booking) {
      <p class="py-4">האם אתה בטוח שברצונך למחוק את ההזמנה של {{ booking.customer.fullName }}?</p>
    }
    <div class="modal-action">
      <button (click)="closeDeleteModal()" class="btn btn-ghost">ביטול</button>
      <button (click)="confirmDelete()" class="btn btn-error">מחק</button>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button (click)="closeDeleteModal()">close</button>
  </form>
</dialog>

<!-- Toast Notification -->
<div class="toast toast-bottom toast-center">
  @if(showNotification) {
    <div class="alert alert-success">
      <span>{{ notificationText }}</span>
    </div>
  }
</div>